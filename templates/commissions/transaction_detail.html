{% extends "ui/module_content.html" %}
{% load i18n %}

{% block tabbar %}
    {% include "commissions/partials/tabbar.html" with active_tab="transactions" %}
{% endblock %}

{% block page_content %}
<div class="p-md">
    <ion-card>
        <ion-card-header>
            <ion-card-subtitle>{% trans "Transaction" %} #{{ transaction.id }}</ion-card-subtitle>
            <ion-card-title>{{ transaction.staff_member }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-list lines="none">
                <ion-item>
                    <ion-label>{% trans "Type" %}</ion-label>
                    <ion-note slot="end">{{ transaction.transaction_type|title }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Date" %}</ion-label>
                    <ion-note slot="end">{{ transaction.transaction_date }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Base Amount" %}</ion-label>
                    <ion-note slot="end">${{ transaction.base_amount }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Rate Applied" %}</ion-label>
                    <ion-note slot="end">{{ transaction.rate_applied }}%</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Commission" %}</ion-label>
                    <ion-note slot="end" class="font-bold">${{ transaction.commission_amount }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Tax Withheld" %}</ion-label>
                    <ion-note slot="end">${{ transaction.tax_withheld }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Net Amount" %}</ion-label>
                    <ion-note slot="end" class="font-bold text-success">${{ transaction.net_amount }}</ion-note>
                </ion-item>
                <ion-item>
                    <ion-label>{% trans "Status" %}</ion-label>
                    <ion-badge slot="end" color="{% if transaction.status == 'approved' %}success{% elif transaction.status == 'pending' %}warning{% elif transaction.status == 'paid' %}primary{% else %}medium{% endif %}">
                        {{ transaction.status|title }}
                    </ion-badge>
                </ion-item>
                {% if transaction.reference_type %}
                <ion-item>
                    <ion-label>{% trans "Reference" %}</ion-label>
                    <ion-note slot="end">{{ transaction.reference_type }}: {{ transaction.reference_id }}</ion-note>
                </ion-item>
                {% endif %}
                {% if transaction.notes %}
                <ion-item>
                    <ion-label class="ion-text-wrap">
                        <p class="text-secondary">{% trans "Notes" %}</p>
                        <p>{{ transaction.notes }}</p>
                    </ion-label>
                </ion-item>
                {% endif %}
            </ion-list>
        </ion-card-content>
    </ion-card>

    {% if transaction.status == 'pending' %}
    <div class="flex gap-md mt-md">
        <form method="post" action="{% url 'commissions:transaction_approve' transaction.id %}" class="flex-1">
            {% csrf_token %}
            <ion-button expand="block" color="success" type="submit">
                {% icon "checkmark-outline" %}
                {% trans "Approve" %}
            </ion-button>
        </form>
        <form method="post" action="{% url 'commissions:transaction_reject' transaction.id %}" class="flex-1">
            {% csrf_token %}
            <ion-button expand="block" color="danger" type="submit">
                {% icon "close-outline" %}
                {% trans "Reject" %}
            </ion-button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
