{% load i18n djicons %}

<div class="p-4">
    <!-- Commission Defaults -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "calculator-outline" css_class="text-primary" %} {% trans "Commission Defaults" %}</h3>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Default Commission Rate" %}</div>
                    <div class="list-item-note">{% trans "Applied when no specific rule matches" %}</div>
                </div>
                <div class="list-item-end">
                    <div class="flex items-center gap-1">
                        <input type="number" name="default_commission_rate"
                               value="{{ settings.default_commission_rate }}"
                               class="input input--sm"
                               style="width: 80px;"
                               hx-post="{% url 'commissions:settings_input' %}"
                               hx-vals='js:{field: "default_commission_rate", value: event.target.value}'
                               hx-trigger="change"
                               hx-swap="none"
                               step="0.01" min="0" max="100">
                        <span class="text-muted">%</span>
                    </div>
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Calculation Basis" %}</div>
                    <div class="list-item-note">{% trans "What the commission percentage is based on" %}</div>
                </div>
                <div class="list-item-end">
                    <select name="calculation_basis" class="select select--sm" style="width: 180px;"
                            hx-post="{% url 'commissions:settings_save' %}"
                            hx-include="[name]"
                            hx-trigger="change"
                            hx-swap="none">
                        <option value="gross" {% if settings.calculation_basis == 'gross' %}selected{% endif %}>{% trans "Gross Sales" %}</option>
                        <option value="net" {% if settings.calculation_basis == 'net' %}selected{% endif %}>{% trans "Net Sales" %}</option>
                        <option value="profit" {% if settings.calculation_basis == 'profit' %}selected{% endif %}>{% trans "Profit Margin" %}</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Payout Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "cash-outline" css_class="text-success" %} {% trans "Payout Settings" %}</h3>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Payout Frequency" %}</div>
                    <div class="list-item-note">{% trans "How often commissions are paid out" %}</div>
                </div>
                <div class="list-item-end">
                    <select name="payout_frequency" class="select select--sm" style="width: 150px;"
                            hx-post="{% url 'commissions:settings_save' %}"
                            hx-include="[name]"
                            hx-trigger="change"
                            hx-swap="none">
                        <option value="weekly" {% if settings.payout_frequency == 'weekly' %}selected{% endif %}>{% trans "Weekly" %}</option>
                        <option value="biweekly" {% if settings.payout_frequency == 'biweekly' %}selected{% endif %}>{% trans "Bi-weekly" %}</option>
                        <option value="monthly" {% if settings.payout_frequency == 'monthly' %}selected{% endif %}>{% trans "Monthly" %}</option>
                        <option value="custom" {% if settings.payout_frequency == 'custom' %}selected{% endif %}>{% trans "Custom" %}</option>
                    </select>
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Payout Day" %}</div>
                    <div class="list-item-note">{% trans "Day of month/week for payouts" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="number" name="payout_day"
                           value="{{ settings.payout_day }}"
                           class="input input--sm"
                           style="width: 80px;"
                           hx-post="{% url 'commissions:settings_input' %}"
                           hx-vals='js:{field: "payout_day", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none"
                           min="1" max="31">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Minimum Payout Amount" %}</div>
                    <div class="list-item-note">{% trans "Minimum amount required to process a payout" %}</div>
                </div>
                <div class="list-item-end">
                    <div class="flex items-center gap-1">
                        <span class="text-muted">$</span>
                        <input type="number" name="minimum_payout_amount"
                               value="{{ settings.minimum_payout_amount }}"
                               class="input input--sm"
                               style="width: 100px;"
                               hx-post="{% url 'commissions:settings_input' %}"
                               hx-vals='js:{field: "minimum_payout_amount", value: event.target.value}'
                               hx-trigger="change"
                               hx-swap="none"
                               step="0.01" min="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tax Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "document-text-outline" css_class="text-warning" %} {% trans "Tax Settings" %}</h3>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Apply Tax Withholding" %}</div>
                    <div class="list-item-note">{% trans "Automatically withhold taxes from commission payments" %}</div>
                </div>
                <div class="list-item-end">
                    <label class="toggle">
                        <input type="checkbox" name="apply_tax_withholding"
                               {% if settings.apply_tax_withholding %}checked{% endif %}
                               hx-post="{% url 'commissions:settings_toggle' %}"
                               hx-vals='js:{field: "apply_tax_withholding"}'
                               hx-swap="none">
                        
                    </label>
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Tax Withholding Rate" %}</div>
                    <div class="list-item-note">{% trans "Percentage to withhold for taxes" %}</div>
                </div>
                <div class="list-item-end">
                    <div class="flex items-center gap-1">
                        <input type="number" name="tax_withholding_rate"
                               value="{{ settings.tax_withholding_rate }}"
                               class="input input--sm"
                               style="width: 80px;"
                               hx-post="{% url 'commissions:settings_input' %}"
                               hx-vals='js:{field: "tax_withholding_rate", value: event.target.value}'
                               hx-trigger="change"
                               hx-swap="none"
                               step="0.01" min="0" max="100">
                        <span class="text-muted">%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Display Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "eye-outline" css_class="text-primary" %} {% trans "Display Settings" %}</h3>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Show Commission on Receipt" %}</div>
                    <div class="list-item-note">{% trans "Display commission info on sales receipts" %}</div>
                </div>
                <div class="list-item-end">
                    <label class="toggle">
                        <input type="checkbox" name="show_commission_on_receipt"
                               {% if settings.show_commission_on_receipt %}checked{% endif %}
                               hx-post="{% url 'commissions:settings_toggle' %}"
                               hx-vals='js:{field: "show_commission_on_receipt"}'
                               hx-swap="none">
                        
                    </label>
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Show Pending Commission to Staff" %}</div>
                    <div class="list-item-note">{% trans "Let staff see their pending commissions" %}</div>
                </div>
                <div class="list-item-end">
                    <label class="toggle">
                        <input type="checkbox" name="show_pending_commission"
                               {% if settings.show_pending_commission %}checked{% endif %}
                               hx-post="{% url 'commissions:settings_toggle' %}"
                               hx-vals='js:{field: "show_pending_commission"}'
                               hx-swap="none">
                        
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "link-outline" %} {% trans "Quick Actions" %}</h3>
        </div>
        <div class="list">
            <a hx-get="{% url 'commissions:rule_list' %}"
               hx-target="#main-content-area"
               hx-push-url="true"
               class="list-item list-item-clickable">
                <div class="list-item-start">{% icon "options-outline" css_class="text-primary" %}</div>
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Commission Rules" %}</div>
                    <div class="list-item-note">{% trans "Manage rules for commission calculation" %}</div>
                </div>
                <div class="list-item-end">{% icon "chevron-forward-outline" css_class="text-muted" %}</div>
            </a>
            <a hx-get="{% url 'commissions:payout_list' %}"
               hx-target="#main-content-area"
               hx-push-url="true"
               class="list-item list-item-clickable">
                <div class="list-item-start">{% icon "cash-outline" css_class="text-success" %}</div>
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Payouts" %}</div>
                    <div class="list-item-note">{% trans "View and manage commission payouts" %}</div>
                </div>
                <div class="list-item-end">{% icon "chevron-forward-outline" css_class="text-muted" %}</div>
            </a>
            <a hx-get="{% url 'commissions:adjustment_list' %}"
               hx-target="#main-content-area"
               hx-push-url="true"
               class="list-item list-item-clickable">
                <div class="list-item-start">{% icon "swap-horizontal-outline" css_class="text-warning" %}</div>
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Adjustments" %}</div>
                    <div class="list-item-note">{% trans "Manual adjustments and corrections" %}</div>
                </div>
                <div class="list-item-end">{% icon "chevron-forward-outline" css_class="text-muted" %}</div>
            </a>
        </div>
    </div>

    <!-- Reset -->
    <div class="card" style="border-color: var(--color-warning)">
        <div class="card-header">
            <h3 class="card-title text-warning">{% trans "Reset Settings" %}</h3>
        </div>
        <div class="card-body">
            <p class="text-muted mb-3">{% trans "Restore all commission settings to their default values." %}</p>
            <button type="button" class="btn color-warning btn-outline"
                    onclick="resetSettings()">
                {% icon "refresh-outline" %} {% trans "Reset to Defaults" %}
            </button>
        </div>
    </div>
</div>

<script>
function resetSettings() {
    if (confirm('{% trans "Reset all settings to defaults?" %}')) {
        fetch('{% url "commissions:settings_reset" %}', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
        }).then(r => {
            if (r.ok) htmx.ajax('GET', '{% url "commissions:settings" %}', '#main-content-area');
        });
    }
}
</script>
