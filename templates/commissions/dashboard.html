{% extends "ui/module_content.html" %}
{% load i18n %}

{% block tabbar %}
    {% include "commissions/partials/tabbar.html" with active_tab="dashboard" %}
{% endblock %}

{% block page_content %}
<div class="p-md">
    <!-- Stats Cards -->
    <div class="grid-cols-4 gap-md mb-lg">
        <ion-card class="card-stat">
            <ion-card-content>
                <div class="text-secondary text-sm">{% trans "Total Commission" %}</div>
                <div class="text-xl font-bold">${{ stats.total_commission|default:"0.00" }}</div>
                <div class="text-xs text-secondary">{% trans "This month" %}</div>
            </ion-card-content>
        </ion-card>

        <ion-card class="card-stat">
            <ion-card-content>
                <div class="text-secondary text-sm">{% trans "Net Amount" %}</div>
                <div class="text-xl font-bold text-success">${{ stats.total_net|default:"0.00" }}</div>
                <div class="text-xs text-secondary">{% trans "After tax" %}</div>
            </ion-card-content>
        </ion-card>

        <ion-card class="card-stat">
            <ion-card-content>
                <div class="text-secondary text-sm">{% trans "Tax Withheld" %}</div>
                <div class="text-xl font-bold text-warning">${{ stats.total_tax|default:"0.00" }}</div>
                <div class="text-xs text-secondary">{% trans "This month" %}</div>
            </ion-card-content>
        </ion-card>

        <ion-card class="card-stat">
            <ion-card-content>
                <div class="text-secondary text-sm">{% trans "Pending Approval" %}</div>
                <div class="text-xl font-bold text-danger">{{ stats.total_pending|default:"0" }}</div>
                <div class="text-xs text-secondary">{% trans "Items" %}</div>
            </ion-card-content>
        </ion-card>
    </div>

    <!-- Quick Actions -->
    <div class="grid-cols-2 gap-lg">
        <!-- Recent Transactions -->
        <ion-card>
            <ion-card-header>
                <ion-card-title>{% trans "Recent Transactions" %}</ion-card-title>
            </ion-card-header>
            <ion-card-content class="p-0">
                <ion-list lines="full">
                    {% for trans in recent_transactions %}
                    <ion-item href="/modules/commissions/transactions/{{ trans.id }}/" class="list-item-clickable">
                        <ion-label>
                            <h3>{{ trans.staff_member }}</h3>
                            <p>${{ trans.commission_amount }} - {{ trans.transaction_type }}</p>
                        </ion-label>
                        <ion-badge slot="end" color="{% if trans.status == 'approved' %}success{% elif trans.status == 'pending' %}warning{% elif trans.status == 'paid' %}primary{% else %}medium{% endif %}">
                            {{ trans.status|title }}
                        </ion-badge>
                    </ion-item>
                    {% empty %}
                    <ion-item>
                        <ion-label class="text-center text-secondary">{% trans "No recent transactions" %}</ion-label>
                    </ion-item>
                    {% endfor %}
                </ion-list>
            </ion-card-content>
            <ion-button expand="block" fill="clear" href="/modules/commissions/transactions/">
                {% trans "View All Transactions" %}
                <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
            </ion-button>
        </ion-card>

        <!-- Pending Items -->
        <ion-card>
            <ion-card-header>
                <ion-card-title>{% trans "Pending Approval" %}</ion-card-title>
            </ion-card-header>
            <ion-card-content class="p-0">
                <ion-list lines="full">
                    {% for trans in pending_transactions %}
                    <ion-item href="/modules/commissions/transactions/{{ trans.id }}/" class="list-item-clickable">
                        <ion-icon name="receipt-outline" slot="start" color="warning"></ion-icon>
                        <ion-label>
                            <h3>{{ trans.staff_member }}</h3>
                            <p>${{ trans.commission_amount }}</p>
                        </ion-label>
                        <ion-note slot="end">{{ trans.transaction_date }}</ion-note>
                    </ion-item>
                    {% empty %}
                    <ion-item>
                        <ion-label class="text-center text-secondary">{% trans "No pending items" %}</ion-label>
                    </ion-item>
                    {% endfor %}

                    {% for payout in pending_payouts %}
                    <ion-item href="/modules/commissions/payouts/{{ payout.id }}/" class="list-item-clickable">
                        <ion-icon name="wallet-outline" slot="start" color="warning"></ion-icon>
                        <ion-label>
                            <h3>{{ payout.staff_member }} - Payout</h3>
                            <p>${{ payout.total_amount }}</p>
                        </ion-label>
                        <ion-note slot="end">{{ payout.period_end }}</ion-note>
                    </ion-item>
                    {% endfor %}
                </ion-list>
            </ion-card-content>
        </ion-card>
    </div>
</div>
{% endblock %}
